<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Piano Inventory</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .form-section, .filter-section { margin-bottom: 20px; }
    .piano-card {
      border: 1px solid #ccc; padding: 15px; margin: 10px 0;
      border-radius: 8px; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    img { max-width: 200px; display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Piano Inventory</h1>

  <!-- Add/Edit Form -->
  <div class="form-section">
    <h2>Add / Edit Piano</h2>
    <form id="pianoForm">
      <input type="hidden" id="pianoId">
      <label>Brand: <input type="text" id="brand" required></label><br><br>
      <label>Model: <input type="text" id="model"></label><br><br>
      <label>Color: <input type="text" id="color"></label><br><br>
      <label>Cost: <input type="number" id="cost" step="0.01"></label><br><br>
      <label>Size:
        <select id="size">
          <option value="">Select Size</option>
          <option value="4'11">4'11"</option>
          <option value="5'1">5'1"</option>
          <option value="5'3">5'3"</option>
          <option value="5'7">5'7"</option>
          <option value="5'10">5'10"</option>
          <option value="6'1">6'1"</option>
          <option value="6'7">6'7"</option>
          <option value="7'0">7'0"</option>
          <option value="7'6">7'6"</option>
          <option value="9'0">9'0" (Concert Grand)</option>
        </select>
      </label><br><br>
      <label>Notes: <textarea id="notes"></textarea></label><br><br>
      <label>Photo: <input type="file" id="photo"></label><br><br>
      <button type="submit">Save Piano</button>
    </form>
  </div>

  <!-- Filters -->
  <div class="filter-section">
    <h2>Filters</h2>
    <label for="brandFilter">Brand:</label>
    <input type="text" id="brandFilter" oninput="applyFilters()">

    <label for="minCost">Min Cost:</label>
    <input type="number" id="minCost" oninput="applyFilters()">

    <label for="maxCost">Max Cost:</label>
    <input type="number" id="maxCost" oninput="applyFilters()">

    <label for="sizeFilter">Size:</label>
    <select id="sizeFilter" onchange="applyFilters()">
      <option value="">All Sizes</option>
      <option value="4'11">4'11"</option>
      <option value="5'1">5'1"</option>
      <option value="5'3">5'3"</option>
      <option value="5'7">5'7"</option>
      <option value="5'10">5'10"</option>
      <option value="6'1">6'1"</option>
      <option value="6'7">6'7"</option>
      <option value="7'0">7'0"</option>
      <option value="7'6">7'6"</option>
      <option value="9'0">9'0" (Concert Grand)</option>
    </select>

    <label for="searchInput">Search:</label>
    <input type="text" id="searchInput" oninput="applyFilters()">
  </div>

  <!-- Piano Listings -->
  <div id="pianoList"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "pianoinv.firebaseapp.com",
      projectId: "pianoinv",
      storageBucket: "pianoinv.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const pianoForm = document.getElementById("pianoForm");
    const pianoList = document.getElementById("pianoList");

    let allPianos = [];

    async function fetchPianos() {
      const snapshot = await getDocs(collection(db, "pianos"));
      allPianos = snapshot.docs;
      renderPianos(allPianos);
    }

    function renderPianos(pianos) {
      pianoList.innerHTML = "";
      pianos.forEach(docSnap => {
        const piano = docSnap.data();
        const div = document.createElement("div");
        div.className = "piano-card";
        div.innerHTML = `
          <h3>${piano.brand} ${piano.model || ""}</h3>
          <p>Color: ${piano.color || ""}</p>
          <p>Cost: $${piano.cost || ""}</p>
          <p>Size: ${piano.size || ""}</p>
          <p>Notes: ${piano.notes || ""}</p>
          ${piano.photoURL ? `<img src="${piano.photoURL}" alt="Piano photo">` : ""}
          <button onclick="editPiano('${docSnap.id}')">Edit</button>
          <button onclick="deletePiano('${docSnap.id}')">Delete</button>
        `;
        pianoList.appendChild(div);
      });
    }

    pianoForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("pianoId").value;
      const brand = document.getElementById("brand").value;
      const model = document.getElementById("model").value;
      const color = document.getElementById("color").value;
      const cost = document.getElementById("cost").value;
      const size = document.getElementById("size").value;
      const notes = document.getElementById("notes").value;
      const photoFile = document.getElementById("photo").files[0];

      let photoURL = "";
      if (photoFile) {
        const storageRef = ref(storage, "piano_photos/" + Date.now() + "_" + photoFile.name);
        await uploadBytes(storageRef, photoFile);
        photoURL = await getDownloadURL(storageRef);
      }

      if (id) {
        await updateDoc(doc(db, "pianos", id), { brand, model, color, cost, size, notes, photoURL });
      } else {
        await addDoc(collection(db, "pianos"), { brand, model, color, cost, size, notes, photoURL });
      }

      pianoForm.reset();
      document.getElementById("pianoId").value = "";
      fetchPianos();
    });

    window.editPiano = async function(id) {
      const pianoDoc = allPianos.find(d => d.id === id);
      if (pianoDoc) {
        const piano = pianoDoc.data();
        document.getElementById("pianoId").value = id;
        document.getElementById("brand").value = piano.brand || "";
        document.getElementById("model").value = piano.model || "";
        document.getElementById("color").value = piano.color || "";
        document.getElementById("cost").value = piano.cost || "";
        document.getElementById("size").value = piano.size || "";
        document.getElementById("notes").value = piano.notes || "";
      }
    }

    window.deletePiano = async function(id) {
      await deleteDoc(doc(db, "pianos", id));
      fetchPianos();
    }

    window.applyFilters = function() {
      const brand = document.getElementById("brandFilter").value.toLowerCase();
      const minCost = parseFloat(document.getElementById("minCost").value) || 0;
      const maxCost = parseFloat(document.getElementById("maxCost").value) || Infinity;
      const size = document.getElementById("sizeFilter").value;
      const searchText = document.getElementById("searchInput").value.toLowerCase();

      const filtered = allPianos.filter(docSnap => {
        const piano = docSnap.data();
        const pianoCost = parseFloat(piano.cost) || 0;
        const pianoSize = piano.size || "";
        const pianoBrand = piano.brand || "";

        const matchesBrand = !brand || pianoBrand.toLowerCase().includes(brand);
        const matchesCost = pianoCost >= minCost && pianoCost <= maxCost;
        const matchesSize = !size || pianoSize === size;
        const matchesSearch =
          !searchText ||
          (pianoBrand.toLowerCase().includes(searchText)) ||
          (piano.model && piano.model.toLowerCase().includes(searchText)) ||
          (piano.color && piano.color.toLowerCase().includes(searchText)) ||
          (pianoSize.toLowerCase().includes(searchText)) ||
          (piano.notes && piano.notes.toLowerCase().includes(searchText));

        return matchesBrand && matchesCost && matchesSize && matchesSearch;
      });

      renderPianos(filtered);
    };

    fetchPianos();
  </script>
</body>
</html>
