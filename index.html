<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Piano Inventory</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #login-section, #inventory-section { margin-bottom: 20px; }
    input, select, button { margin: 5px; padding: 8px; }
    .piano-item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Piano Inventory</h1>

  <!-- Login Section -->
  <div id="login-section">
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button id="login-btn">Login</button>
    <button id="logout-btn" style="display:none;">Logout</button>
  </div>

  <!-- Inventory Section -->
  <div id="inventory-section" style="display:none;">
    <h2>Add Piano</h2>
    <input type="text" id="brand" placeholder="Brand" />
    <input type="text" id="model" placeholder="Model" />
    <input type="text" id="serial" placeholder="Serial Number" />
    <input type="number" id="price" placeholder="Price" />
    <input type="text" id="color" placeholder="Color" />
    <input type="text" id="length" placeholder="Length (e.g. 6'1)" />
    <select id="location">
      <option value="Gallery">Gallery</option>
      <option value="Cartersville">Cartersville</option>
    </select>
    <select id="status">
      <option value="On Floor">On Floor</option>
      <option value="In Storage">In Storage</option>
      <option value="Sold">Sold</option>
      <option value="Detailed">Detailed</option>
      <option value="Potential Buyer">Potential Buyer</option>
    </select>
    <button id="add-btn">Add Piano</button>

    <h2>Inventory List</h2>
    <div id="inventory-list"></div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <script>
    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA2932IBDCeUix6OdRaJMDIisHX0SbyDFo",
      authDomain: "pianoinv.firebaseapp.com",
      projectId: "pianoinv",
      storageBucket: "pianoinv.appspot.com",
      messagingSenderId: "651707888262",
      appId: "1:651707888262:web:23131a782e31a7bb511707",
      measurementId: "G-1XQLEV28JZ"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Elements
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const inventorySection = document.getElementById('inventory-section');
    const addBtn = document.getElementById('add-btn');
    const inventoryList = document.getElementById('inventory-list');

    // Login with Enter key
    passwordInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") loginBtn.click();
    });

    // Auth
    loginBtn.onclick = () => {
      auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
        .catch(err => alert(err.message));
    };

    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        emailInput.style.display = "none";
        passwordInput.style.display = "none";
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        inventorySection.style.display = "block";
        loadInventory();
      } else {
        emailInput.style.display = "inline-block";
        passwordInput.style.display = "inline-block";
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        inventorySection.style.display = "none";
      }
    });

    // Add piano
    addBtn.onclick = async () => {
      const brand = document.getElementById('brand').value;
      const model = document.getElementById('model').value;
      const serial = document.getElementById('serial').value;
      const price = document.getElementById('price').value;
      const color = document.getElementById('color').value;
      const length = document.getElementById('length').value;
      const location = document.getElementById('location').value;
      const status = document.getElementById('status').value;

      if (!brand || !model || !serial || !price) {
        alert("Please fill out all required fields.");
        return;
      }

      await db.collection("pianos").add({ 
        brand, model, serial, price, color, length, location, status 
      });

      // Reset inputs
      document.getElementById('brand').value = '';
      document.getElementById('model').value = '';
      document.getElementById('serial').value = '';
      document.getElementById('price').value = '';
      document.getElementById('color').value = '';
      document.getElementById('length').value = '';
      document.getElementById('location').value = 'Gallery';
      document.getElementById('status').value = 'On Floor';
    };

    // Load inventory live
    function loadInventory() {
      db.collection("pianos").onSnapshot(snapshot => {
        inventoryList.innerHTML = '';
        snapshot.forEach(doc => {
          const piano = doc.data();
          const div = document.createElement('div');
          div.className = 'piano-item';
          div.innerHTML = `
            <strong>${piano.brand} ${piano.model}</strong><br/>
            Serial: ${piano.serial}<br/>
            Price: $${piano.price}<br/>
            Color: ${piano.color || "N/A"}<br/>
            Length: ${piano.length || "N/A"}<br/>
            Location: ${piano.location || "N/A"}<br/>
            Status: ${piano.status}<br/>
            <button onclick="deletePiano('${doc.id}')">Delete</button>
          `;
          inventoryList.appendChild(div);
        });
      });
    }

    // Delete piano
    async function deletePiano(id) {
      await db.collection("pianos").doc(id).delete();
    }
    window.deletePiano = deletePiano;
  </script>
</body>
</html>
