<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Piano Inventory</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .hidden { display: none; }
    .tab { margin-bottom: 20px; }
    .piano-card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    .piano-card img {
      max-width: 200px;
      display: block;
      margin-top: 10px;
    }
    .btn { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; }
    .btn-add { background: green; color: white; }
    .btn-sell { background: blue; color: white; }
    .btn-delete { background: red; color: white; }
    .btn-archive { background: gray; color: white; }
  </style>
</head>
<body>
  <h1>Piano Inventory</h1>

  <!-- Login Section -->
  <div id="login-section">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <button id="logoutBtn" class="hidden">Logout</button>
  </div>

  <!-- Add Piano Form -->
  <div id="form-tab" class="hidden">
    <h2>Add Piano</h2>
    <form id="addPianoForm">
      <label>Brand:</label>
      <input type="text" id="brand" required><br><br>

      <label>Model:</label>
      <input type="text" id="model"><br><br>

      <label>Year:</label>
      <input type="number" id="year"><br><br>

      <label>Color:</label>
      <input type="text" id="color"><br><br>

      <label>Length:</label>
      <input type="text" id="length"><br><br>

      <label>Location:</label>
      <select id="location">
        <option value="Gallery">Gallery</option>
        <option value="Cartersville">Cartersville</option>
      </select><br><br>

      <label>Player System:</label>
      <input type="checkbox" id="playerSystem"> Yes<br><br>

      <label>Detailed:</label>
      <input type="checkbox" id="detailed"> Yes<br><br>

      <label>Date of Detail:</label>
      <input type="date" id="detailDate"><br><br>

      <label>Notes:</label><br>
      <textarea id="notes" rows="3"></textarea><br><br>

      <label>Photo:</label>
      <input type="file" id="photo" accept="image/*"><br><br>

      <button type="submit" class="btn btn-add">Add Piano</button>
    </form>
  </div>

  <!-- Tabs -->
  <div>
    <button onclick="showTab('active')">Active</button>
    <button onclick="showTab('sold')">Sold</button>
    <button onclick="showTab('archive')">Archive</button>
  </div>

  <!-- Inventory Display -->
  <div id="active" class="tab"></div>
  <div id="sold" class="tab hidden"></div>
  <div id="archive" class="tab hidden"></div>

  <script>
    // Firebase config (your values here)
    const firebaseConfig = {
      apiKey: "AIzaSyA2932IBDCeUix6OdRaJMDIisHX0SbyDFo",
      authDomain: "pianoinv.firebaseapp.com",
      projectId: "pianoinv",
      storageBucket: "pianoinv.appspot.com", // âœ… fixed storage bucket
      messagingSenderId: "651707888262",
      appId: "1:651707888262:web:23131a782e31a7bb511707",
      measurementId: "G-1XQLEV28JZ"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Show/Hide Tabs
    function showTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.add('hidden'));
      document.getElementById(tabName).classList.remove('hidden');
    }

    // Login
    document.getElementById("loginBtn").addEventListener("click", () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          document.getElementById("loginBtn").classList.add("hidden");
          document.getElementById("logoutBtn").classList.remove("hidden");
          document.getElementById("form-tab").classList.remove("hidden");
          document.getElementById("email").classList.add("hidden");
          document.getElementById("password").classList.add("hidden");
        })
        .catch(err => alert(err.message));
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      auth.signOut();
      document.getElementById("loginBtn").classList.remove("hidden");
      document.getElementById("logoutBtn").classList.add("hidden");
      document.getElementById("form-tab").classList.add("hidden");
      document.getElementById("email").classList.remove("hidden");
      document.getElementById("password").classList.remove("hidden");
    });

    // Upload Photo
    async function uploadPhoto(file) {
      const storageRef = storage.ref();
      const fileRef = storageRef.child('pianoPhotos/' + Date.now() + '_' + file.name);
      await fileRef.put(file);
      return await fileRef.getDownloadURL();
    }

    // Add Piano
    document.getElementById("addPianoForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const fileInput = document.getElementById("photo");
      let photoURL = "";

      if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        photoURL = await uploadPhoto(file);
      }

      await db.collection("pianos").add({
        brand: document.getElementById("brand").value,
        model: document.getElementById("model").value,
        year: document.getElementById("year").value,
        color: document.getElementById("color").value,
        length: document.getElementById("length").value,
        location: document.getElementById("location").value,
        playerSystem: document.getElementById("playerSystem").checked,
        detailed: document.getElementById("detailed").checked,
        detailDate: document.getElementById("detailDate").value,
        notes: document.getElementById("notes").value,
        photo: photoURL,
        status: "active",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      e.target.reset();
    });

    // Render Pianos
    function renderPianos() {
      ["active","sold","archive"].forEach(status => {
        const container = document.getElementById(status);
        container.innerHTML = "";
        db.collection("pianos").where("status","==",status).onSnapshot(snapshot => {
          container.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const pianoDiv = document.createElement("div");
            pianoDiv.className = "piano-card";
            pianoDiv.innerHTML = `
              <strong>${data.brand} ${data.model || ""}</strong><br>
              Year: ${data.year || ""} | Color: ${data.color || ""} | Length: ${data.length || ""}<br>
              Location: ${data.location || ""} | Player System: ${data.playerSystem ? "Yes" : "No"}<br>
              Detailed: ${data.detailed ? "Yes" : "No"} ${data.detailDate ? "(Date: "+data.detailDate+")" : ""}<br>
              Notes: ${data.notes || ""}<br>
              ${data.photo ? `<img src="${data.photo}" alt="Piano Photo">` : ""}
            `;

            if (status === "active") {
              pianoDiv.innerHTML += `
                <button class="btn btn-sell" onclick="updateStatus('${doc.id}','sold')">Mark Sold</button>
                <button class="btn btn-delete" onclick="deletePiano('${doc.id}')">Delete</button>
              `;
            } else if (status === "sold") {
              pianoDiv.innerHTML += `
                <button class="btn btn-archive" onclick="updateStatus('${doc.id}','archive')">Archive</button>
              `;
            } else if (status === "archive") {
              pianoDiv.innerHTML += `
                <button class="btn btn-add" onclick="updateStatus('${doc.id}','active')">Move to Active</button>
                <button class="btn btn-delete" onclick="deletePiano('${doc.id}')">Delete</button>
              `;
            }
            container.appendChild(pianoDiv);
          });
        });
      });
    }

    // Update Status
    async function updateStatus(id, newStatus) {
      await db.collection("pianos").doc(id).update({ status: newStatus });
    }

    // Delete Piano
    async function deletePiano(id) {
      if (confirm("Are you sure you want to delete this piano?")) {
        await db.collection("pianos").doc(id).delete();
      }
    }

    // Run
    renderPianos();
  </script>
</body>
</html>
