<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Piano Inventory</title>
</head>
<body>
  <h1>Piano Inventory</h1>

  <!-- Login UI -->
  <div id="login-container">
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button id="login-btn">Login</button>
  </div>
  <button id="logout-btn" style="display:none;">Logout</button>

  <!-- Inventory Form -->
  <div id="inventory-form" style="display:none;">
    <input type="text" id="brand" placeholder="Brand" />
    <input type="text" id="model" placeholder="Model" />
    <input type="text" id="serial" placeholder="Serial" />
    <input type="number" id="price" placeholder="Price" />
    <select id="status">
      <option value="on floor">On Floor</option>
      <option value="in storage">In Storage</option>
      <option value="sold">Sold</option>
      <option value="detailed">Detailed</option>
      <option value="potential buyer">Potential Buyer</option>
    </select>
    <input type="file" id="photo" />
    <button id="add-btn">Add Piano</button>
  </div>

  <!-- Inventory List -->
  <ul id="inventory-list"></ul>

  <!-- Firebase SDKs (Compat Versions) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

  <script>
    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA2932IBDCeUix6OdRaJMDIisHX0SbyDFo",
      authDomain: "pianoinv.firebaseapp.com",
      projectId: "pianoinv",
      storageBucket: "pianoinv.appspot.com",
      messagingSenderId: "651707888262",
      appId: "1:651707888262:web:23131a782e31a7bb511707",
      measurementId: "G-1XQLEV28JZ"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // DOM elements
    const loginContainer = document.getElementById("login-container");
    const logoutBtn = document.getElementById("logout-btn");
    const inventoryForm = document.getElementById("inventory-form");
    const addBtn = document.getElementById("add-btn");
    const inventoryList = document.getElementById("inventory-list");

    // Login
    document.getElementById("login-btn").addEventListener("click", () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          loginContainer.style.display = "none";
          logoutBtn.style.display = "block";
          inventoryForm.style.display = "block";
        })
        .catch(err => alert(err.message));
    });

    // Logout
    logoutBtn.addEventListener("click", () => {
      auth.signOut().then(() => {
        loginContainer.style.display = "block";
        logoutBtn.style.display = "none";
        inventoryForm.style.display = "none";
      });
    });

    // Add Piano
    addBtn.addEventListener("click", async () => {
      const brand = document.getElementById("brand").value;
      const model = document.getElementById("model").value;
      const serial = document.getElementById("serial").value;
      const price = document.getElementById("price").value;
      const status = document.getElementById("status").value;
      const file = document.getElementById("photo").files[0];

      let photoURL = "";
      if (file) {
        const storageRef = storage.ref("piano_photos/" + Date.now() + "_" + file.name);
        await storageRef.put(file);
        photoURL = await storageRef.getDownloadURL();
      }

      await db.collection("inventory").add({
        brand, model, serial, price, status, photoURL,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      document.getElementById("brand").value = "";
      document.getElementById("model").value = "";
      document.getElementById("serial").value = "";
      document.getElementById("price").value = "";
      document.getElementById("status").value = "on floor";
      document.getElementById("photo").value = "";
    });

    // Realtime inventory updates
    db.collection("inventory").orderBy("createdAt", "desc").onSnapshot(snapshot => {
      inventoryList.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${data.brand} ${data.model}</strong> 
          (Serial: ${data.serial}, Price: $${data.price}, Status: ${data.status})
          ${data.photoURL ? `<br><img src="${data.photoURL}" width="100"/>` : ""}
        `;
        inventoryList.appendChild(li);
      });
    });
  </script>
</body>
</html>
