<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Piano Inventory</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- heic2any etc + styles unchanged -->
</head>
<body>
  <h1>ðŸŽ¹ Piano Inventory</h1>

  <!-- ... login, tabs, filters unchanged ... -->

  <!-- Add/Edit Modal -->
  <div id="pianoModal" class="modal hidden">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <h2 id="modalTitle">Add Piano</h2>
      <form id="pianoForm">
        <input type="text" id="brand" placeholder="Brand" required>
        <input type="text" id="model" placeholder="Model">
        <input type="number" id="year" placeholder="Year">
        <input type="text" id="color" placeholder="Color">
        <input type="text" id="length" placeholder="Length">
        <input type="text" id="serial" placeholder="Serial Number"> <!-- âœ… new -->
        <input type="text" id="manufacturer" placeholder="Manufacturer Country"> <!-- âœ… new -->
        <select id="location">
          <option value="Gallery">Gallery</option>
          <option value="Cartersville">Cartersville</option>
        </select>
        <input type="number" id="cost" placeholder="Buying Cost">
        <input type="number" id="listingPrice" placeholder="Listing Price">
        <input type="number" id="soldPrice" placeholder="Sold Price (if sold)">
        <input type="text" id="archiveReason" placeholder="Archive Reason (if archived)">
        <textarea id="notes" placeholder="Notes"></textarea>
        <input type="file" id="photo" accept="image/*">
        <img id="photoPreview" src="" alt="Preview" style="max-width:100%; margin-top:10px; border-radius:6px; display:none;">
        <input type="hidden" id="editingId">
        <input type="hidden" id="currentPhotoURL">
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button type="submit" id="submitBtn" class="green">Add Piano</button>
          <button type="button" id="cancelEditBtn" class="gray hidden">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ... rest unchanged until script ... -->

  <script type="module">
    // ... firebase setup etc unchanged ...

    // DOM bindings
    const serialInput      = document.getElementById("serial");
    const manufacturerInput= document.getElementById("manufacturer");
    // (existing ones remain)

    function resetForm(){
      pianoForm.reset();
      editingId.value="";
      currentPhotoURL.value="";
      photoPreview.src="";
      photoPreview.style.display="none";
      submitBtn.textContent="Add Piano";
      submitBtn.classList.remove("orange");
      submitBtn.classList.add("green");
      cancelEditBtn.classList.add("hidden");
    }

    function setEdit(id,data){
      editingId.value = id;
      brand.value = data.brand || "";
      model.value = data.model || "";
      year.value = data.year != null ? data.year : "";
      color.value = data.color || "";
      lengthInput.value = data.length || "";
      serialInput.value = data.serial || "";                // âœ… load serial
      manufacturerInput.value = data.manufacturer || "";    // âœ… load manufacturer
      locationInput.value = data.location || "Gallery";
      cost.value = data.cost != null ? data.cost : "";
      listingPrice.value = data.listingPrice != null ? data.listingPrice : "";
      soldPrice.value = data.soldPrice != null ? data.soldPrice : "";
      archiveReason.value = data.archiveReason || "";
      notes.value = data.notes || "";
      currentPhotoURL.value = data.photoURL || "";
      // ... rest unchanged ...
    }

    // Save piano
    pianoForm.addEventListener("submit",async e=>{
      e.preventDefault();
      if(!currentUser){ showToast("Sign in required"); return; }
      const id=editingId.value;
      const data={ 
        brand: brand.value || null,
        model: model.value || null,
        year: year.value ? +year.value : null,
        color: color.value || null,
        length: lengthInput.value || null,
        serial: serialInput.value || null,             // âœ… save serial
        manufacturer: manufacturerInput.value || null, // âœ… save manufacturer
        location: locationInput.value || null,
        cost: cost.value ? +cost.value : null,
        listingPrice: listingPrice.value ? +listingPrice.value : null,
        soldPrice: soldPrice.value ? +soldPrice.value : null,
        archiveReason: archiveReason.value || null,
        notes: notes.value || null
      };
      // ... photo handling unchanged ...
    });

    function render(){
      activeListEl.innerHTML=""; soldListEl.innerHTML=""; archiveListEl.innerHTML="";
      activeListEl.classList.toggle("hidden",currentTab!=="active");
      soldListEl.classList.toggle("hidden",currentTab!=="sold");
      archiveListEl.classList.toggle("hidden",currentTab!=="archive");
      soldSummaryEl.classList.toggle("hidden",currentTab!=="sold");

      let filtered=[...docsCache];
      const q=document.getElementById("searchBox").value.toLowerCase();
      if(q){ 
        filtered=filtered.filter(d=>
          (d.brand||"").toLowerCase().includes(q) ||
          (d.model||"").toLowerCase().includes(q) ||
          (d.serial||"").toLowerCase().includes(q) ||              // âœ… search serial
          (d.manufacturer||"").toLowerCase().includes(q) ||        // âœ… search manufacturer
          (d.notes||"").toLowerCase().includes(q) ||
          (d.year?.toString()||"").includes(q)
        );
      }
      // ... rest unchanged ...

      for(const d of filtered){ 
        const c=document.createElement("div"); 
        c.className="card"; 
        let details="";
        if(d.serial) details+=`<div><strong>Serial:</strong> ${d.serial}</div>`;        // âœ… show serial
        if(d.manufacturer) details+=`<div><strong>Made in:</strong> ${d.manufacturer}</div>`; // âœ… show manufacturer
        if(d.notes) details+=`<div class="meta">${d.notes}</div>`;
        // ... build card ...
        c.innerHTML=`${d.photoURL?`<div><img src="${d.photoURL}" alt="photo" style="width:100%; max-height:180px; object-fit:cover; border-radius:6px; margin-bottom:8px; cursor:pointer;" onclick="openPreview('${d.photoURL}')"></div>`:""}
          <h3>${(d.brand||"")+(d.model?" "+d.model:"")}</h3>
          <div class="meta">Status: ${d.status||"active"}${d.year?" â€¢ Year "+d.year:""}${d.color?" â€¢ "+d.color:""}${d.location?" â€¢ "+d.location:""}</div>
          ${details}
          ${extra}
          <div class="actions"> ... </div>`;
        // ... append to lists ...
      }
    }
  </script>
</body>
</html>
