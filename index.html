<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>World Class Piano Gallery CRM</title>
  <link rel="icon" type="image/png" href="logo.png">
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f9; margin:0; padding:20px; color:#333; }
    header { display:flex; align-items:center; background:#2c3e50; color:#fff; padding:15px; border-radius:0 0 10px 10px; }
    header img { height:50px; margin-right:10px; }
    h1 { margin:0; font-size:22px; }
    form, .controls, .search-bar, .filters, .report-section { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.15); margin:20px auto; max-width:900px; }
    label { display:block; margin-top:8px; font-weight:bold; }
    input, textarea, select { width:100%; padding:8px; margin-top:4px; border:1px solid #ccc; border-radius:6px; }
    button { margin-top:10px; padding:8px 14px; border:none; border-radius:6px; background:#3498db; color:#fff; cursor:pointer; }
    button:hover { background:#2980b9; }
    table { width:100%; border-collapse:collapse; background:#fff; margin-top:10px; }
    th, td { padding:8px; border:1px solid #ddd; text-align:left; font-size:14px; }
    th { background:#3498db; color:#fff; cursor:pointer; }
    .actions button { margin-right:5px; }
    .actions .delete { background:#e74c3c; }
    .actions .edit { background:#2ecc71; }
    .report-toggle { display:block; margin:20px auto; max-width:900px; }
    .hidden { display:none; }
    @media(max-width:768px){
      form, .controls, .search-bar, .filters, .report-section { padding:10px; }
      table { font-size:12px; overflow-x:auto; display:block; }
    }
  </style>
</head>
<body>
<header>
  <img src="logo.png" alt="Logo">
  <h1>World Class Piano Gallery CRM</h1>
</header>

<form id="clientForm">
  <label>Name:<input type="text" id="name" required></label>
  <label>Phone:<input type="text" id="phone"></label>
  <label>Email:<input type="email" id="email"></label>
  <label>Piano:<input type="text" id="piano"></label>
  <label>Cost:<input type="number" id="cost" step="0.01"></label>
  <label>Time of Sale:<input type="datetime-local" id="timeOfSale"></label>
  <label>Status:
    <select id="status">
      <option>New Lead</option>
      <option>Working Deal</option>
      <option>Closed</option>
    </select>
  </label>
  <label>Lead Owner:
    <select id="leadOwner" onchange="toggleOtherOwner()">
      <option>Ethan</option>
      <option>Tristan</option>
      <option>Dan</option>
      <option>Other</option>
    </select>
  </label>
  <label id="otherOwnerLabel" class="hidden">Other Owner:<input type="text" id="otherOwner"></label>
  <label>Timeline:<input type="text" id="timeline"></label>
  <label>Notes:<textarea id="notes"></textarea></label>
  <button type="submit">Add Client</button>
</form>

<div class="controls">
  <button onclick="exportCSV()">Export CSV</button>
  <button onclick="exportJSON()">Backup JSON</button>
  <button onclick="triggerJSONImport()">Restore JSON</button>
  <input type="file" id="jsonFile" accept=".json" style="display:none" onchange="importJSON(event)">
</div>

<div class="search-bar">
  <label>Search:<input type="text" id="searchInput" placeholder="Search by name, phone, or piano..."></label>
</div>

<div class="filters">
  <label>Status Filter:
    <select id="statusFilter">
      <option value="">All</option>
      <option>New Lead</option>
      <option>Working Deal</option>
      <option>Closed</option>
    </select>
  </label>
  <label>Owner Filter:
    <select id="ownerFilter">
      <option value="">All</option>
      <option>Ethan</option>
      <option>Tristan</option>
      <option>Dan</option>
      <option>Other</option>
    </select>
  </label>
</div>

<table id="clientTable">
  <thead>
    <tr>
      <th>Name</th><th>Phone</th><th>Email</th><th>Piano</th>
      <th>Cost</th><th>Time of Sale</th><th>Status</th><th>Lead Owner</th>
      <th>Timeline</th><th>Notes</th><th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button class="report-toggle" onclick="toggleReport()">ðŸ“Š View Sales Report</button>

<div id="reportSection" class="report-section hidden">
  <h2>Sales Report</h2>
  <label>Start Date:<input type="date" id="reportStart"></label>
  <label>End Date:<input type="date" id="reportEnd"></label>
  <div>
    <button onclick="quickFilter('month')">This Month</button>
    <button onclick="quickFilter('lastMonth')">Last Month</button>
    <button onclick="quickFilter('year')">This Year</button>
    <button onclick="renderReport()">Apply</button>
  </div>
  <table id="reportTable">
    <thead>
      <tr>
        <th>Name</th><th>Piano</th><th>Cost</th><th>Owner</th><th>Status</th><th>Date</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr><td colspan="6" id="totalRevenue">Total Revenue: $0.00</td></tr>
    </tfoot>
  </table>
  <button onclick="exportReportCSV()">Export Sales Report (CSV)</button>
</div>

<script>
let clients = JSON.parse(localStorage.getItem('clients')||'[]');
const form = document.getElementById('clientForm');
const tableBody = document.querySelector('#clientTable tbody');
const searchInput = document.getElementById('searchInput');
const statusFilter = document.getElementById('statusFilter');
const ownerFilter = document.getElementById('ownerFilter');
let sortAsc = true;

function toggleOtherOwner(){
  document.getElementById('otherOwnerLabel').classList.toggle('hidden', 
    document.getElementById('leadOwner').value!=="Other");
}

function renderClients(filter='', status='', owner=''){
  tableBody.innerHTML='';
  clients
    .filter(c=>c.name.toLowerCase().includes(filter)||
      c.phone.toLowerCase().includes(filter)||
      c.piano.toLowerCase().includes(filter))
    .filter(c=>!status||c.status===status)
    .filter(c=>!owner||c.leadOwner===owner)
    .forEach((c,i)=>{
      const row=document.createElement('tr');
      row.innerHTML=`<td>${c.name}</td><td>${c.phone}</td><td>${c.email}</td>
      <td>${c.piano}</td><td>$${c.cost||0}</td><td>${c.timeOfSale}</td>
      <td>${c.status}</td><td>${c.leadOwner}</td><td>${c.timeline}</td><td>${c.notes}</td>
      <td class="actions"><button class="edit" onclick="editClient(${i})">Edit</button>
      <button class="delete" onclick="deleteClient(${i})">Delete</button></td>`;
      tableBody.appendChild(row);
    });
  localStorage.setItem('clients',JSON.stringify(clients));
}

form.addEventListener('submit',e=>{
  e.preventDefault();
  const ownerSelect=document.getElementById('leadOwner');
  let owner=ownerSelect.value;
  if(owner==="Other"){ owner=document.getElementById('otherOwner').value||"Other"; }
  const newClient={
    name:document.getElementById('name').value,
    phone:document.getElementById('phone').value,
    email:document.getElementById('email').value,
    piano:document.getElementById('piano').value,
    cost:parseFloat(document.getElementById('cost').value)||0,
    timeOfSale:document.getElementById('timeOfSale').value,
    status:document.getElementById('status').value,
    leadOwner:owner,
    timeline:document.getElementById('timeline').value,
    notes:document.getElementById('notes').value
  };
  clients.push(newClient);
  renderClients(searchInput.value.toLowerCase(),statusFilter.value,ownerFilter.value);
  form.reset();
});

function editClient(i){
  const c=clients[i];
  document.getElementById('name').value=c.name;
  document.getElementById('phone').value=c.phone;
  document.getElementById('email').value=c.email;
  document.getElementById('piano').value=c.piano;
  document.getElementById('cost').value=c.cost;
  document.getElementById('timeOfSale').value=c.timeOfSale;
  document.getElementById('status').value=c.status;
  document.getElementById('leadOwner').value=["Ethan","Tristan","Dan"].includes(c.leadOwner)?c.leadOwner:"Other";
  if(document.getElementById('leadOwner').value==="Other"){
    document.getElementById('otherOwnerLabel').classList.remove('hidden');
    document.getElementById('otherOwner').value=c.leadOwner;
  }
  document.getElementById('timeline').value=c.timeline;
  document.getElementById('notes').value=c.notes;
  clients.splice(i,1);
  renderClients(searchInput.value.toLowerCase(),statusFilter.value,ownerFilter.value);
}
function deleteClient(i){ clients.splice(i,1); renderClients(searchInput.value.toLowerCase(),statusFilter.value,ownerFilter.value); }

function exportCSV(){
  let csv='name,phone,email,piano,cost,timeOfSale,status,leadOwner,timeline,notes\n';
  clients.forEach(c=>{ csv+=`${c.name},${c.phone},${c.email},${c.piano},${c.cost},${c.timeOfSale},${c.status},${c.leadOwner},${c.timeline},${c.notes}\n`;});
  downloadFile(csv,'clients.csv','text/csv');
}
function exportJSON(){ downloadFile(JSON.stringify(clients,null,2),'clients.json','application/json'); }
function triggerJSONImport(){ document.getElementById('jsonFile').click(); }
function importJSON(e){ const f=e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=x=>{ try{clients=JSON.parse(x.target.result); renderClients();}catch(err){alert("Invalid JSON");}}; r.readAsText(f); }
function downloadFile(content,name,type){ const blob=new Blob([content],{type}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url;a.download=name;a.click(); URL.revokeObjectURL(url); }

document.querySelector('th:nth-child(5)').addEventListener('click',()=>{
  clients.sort((a,b)=>sortAsc?a.cost-b.cost:b.cost-a.cost); sortAsc=!sortAsc; renderClients(searchInput.value.toLowerCase(),statusFilter.value,ownerFilter.value);
});

searchInput.addEventListener('input',()=>renderClients(searchInput.value.toLowerCase(),statusFilter.value,ownerFilter.value));
statusFilter.addEventListener('change',()=>renderClients(searchInput.value.toLowerCase(),statusFilter.value,ownerFilter.value));
ownerFilter.addEventListener('change',()=>renderClients(searchInput.value.toLowerCase(),statusFilter.value,ownerFilter.value));

function toggleReport(){ document.getElementById('reportSection').classList.toggle('hidden'); renderReport(); }

function renderReport(){
  const tbody=document.querySelector('#reportTable tbody');
  tbody.innerHTML='';
  let start=document.getElementById('reportStart').value;
  let end=document.getElementById('reportEnd').value;
  let startDate=start?new Date(start):new Date("2000-01-01");
  let endDate=end?new Date(end+"T23:59:59"):new Date("2100-01-01");
  let filtered=clients.filter(c=>c.timeOfSale && new Date(c.timeOfSale)>=startDate && new Date(c.timeOfSale)<=endDate);
  let total=0;
  filtered.forEach(c=>{
    const row=document.createElement('tr');
    row.innerHTML=`<td>${c.name}</td><td>${c.piano}</td><td>$${c.cost}</td><td>${c.leadOwner}</td><td>${c.status}</td><td>${c.timeOfSale}</td>`;
    tbody.appendChild(row); total+=c.cost;
  });
  document.getElementById('totalRevenue').innerText=`Total Revenue: $${total.toFixed(2)}`;
}
function quickFilter(type){
  const now=new Date(); let start,end;
  if(type==='month'){ start=new Date(now.getFullYear(),now.getMonth(),1); end=new Date(now.getFullYear(),now.getMonth()+1,0);}
  if(type==='lastMonth'){ start=new Date(now.getFullYear(),now.getMonth()-1,1); end=new Date(now.getFullYear(),now.getMonth(),0);}
  if(type==='year'){ start=new Date(now.getFullYear(),0,1); end=new Date(now.getFullYear(),11,31);}
  document.getElementById('reportStart').value=start.toISOString().split('T')[0];
  document.getElementById('reportEnd').value=end.toISOString().split('T')[0];
  renderReport();
}
function exportReportCSV(){
  let start=document.getElementById('reportStart').value;
  let end=document.getElementById('reportEnd').value;
  let startDate=start?new Date(start):new Date("2000-01-01");
  let endDate=end?new Date(end+"T23:59:59"):new Date("2100-01-01");
  let filtered=clients.filter(c=>c.timeOfSale && new Date(c.timeOfSale)>=startDate && new Date(c.timeOfSale)<=endDate);
  let csv='name,piano,cost,owner,status,date\n';
  let total=0;
  filtered.forEach(c=>{ csv+=`${c.name},${c.piano},${c.cost},${c.leadOwner},${c.status},${c.timeOfSale}\n`; total+=c.cost;});
  csv+=`TOTAL,,${total},,,\n`;
  downloadFile(csv,'sales-report.csv','text/csv');
}

renderClients();
</script>
</body>
</html>
