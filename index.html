<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Piano Inventory</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .hidden {
      display: none;
    }
    details {
      margin: 5px 0;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fafafa;
    }
    details summary {
      cursor: pointer;
      font-weight: bold;
      outline: none;
    }
    .piano-card {
      margin: 5px 0;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fff;
    }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>

  <h1>Piano Inventory</h1>

  <!-- Toggle Filter -->
  <button id="toggleFilterBtn" style="margin:10px 0; padding:8px 16px; background:#444; color:#fff; border:none; border-radius:6px; cursor:pointer;">
    üîç Search / Filter
  </button>

  <!-- Search Filters (collapsible) -->
  <div id="filter-section" class="hidden" style="margin:20px 0; padding:15px; border:1px solid #ccc; border-radius:10px; background:#f9f9f9;">
    <h3 style="margin-top:0;">Filter Pianos</h3>
    
    <label>Brand(s):<br>
      <select id="filterBrand" multiple size="4" style="width:200px; margin:5px 15px 10px 0; border-radius:6px; padding:5px;">
      </select>
    </label>

    <label>Length:<br>
      <select id="filterLength" style="width:200px; margin:5px 15px 10px 0; border-radius:6px; padding:5px;">
        <option value="">All</option>
      </select>
    </label>

    <label>Cost:<br>
      <input type="number" id="filterMinCost" placeholder="Min" style="width:90px; margin-right:5px; border-radius:6px; padding:5px;">
      <input type="number" id="filterMaxCost" placeholder="Max" style="width:90px; border-radius:6px; padding:5px;">
    </label>

    <div style="margin-top:10px;">
      <button onclick="resetFilters()" style="padding:6px 14px; border:none; border-radius:6px; background:#888; color:#fff; cursor:pointer;">
        Reset
      </button>
    </div>
  </div>

  <!-- Filter Summary -->
  <div id="filterSummary" style="margin:10px 0; font-style:italic; color:#444;">
    Showing all pianos
  </div>

  <!-- Tabs -->
  <details open>
    <summary>üéπ Active</summary>
    <div id="active-list"></div>
  </details>

  <details>
    <summary>‚úÖ Sold</summary>
    <div id="sold-list"></div>
  </details>

  <script>
    // üîß Replace with your Firebase project config
    const firebaseConfig = {
      apiKey: "YOUR_KEY",
      authDomain: "YOUR_DOMAIN",
      projectId: "YOUR_PROJECT",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let allPianos = [];

    // Toggle filter visibility
    document.getElementById("toggleFilterBtn").addEventListener("click", () => {
      document.getElementById("filter-section").classList.toggle("hidden");
    });

    // Populate dropdowns dynamically
    function populateDropdowns() {
      const brands = new Set();
      const lengths = new Set();

      allPianos.forEach(doc => {
        const d = doc.data();
        if (d.brand) brands.add(d.brand);
        if (d.length) lengths.add(d.length);
      });

      const brandSelect = document.getElementById("filterBrand");
      const lengthSelect = document.getElementById("filterLength");

      brandSelect.innerHTML = "";
      lengthSelect.innerHTML = "<option value=''>All</option>";

      [...brands].sort().forEach(b => {
        brandSelect.innerHTML += `<option value="${b.toLowerCase()}">${b}</option>`;
      });
      [...lengths].sort().forEach(l => {
        lengthSelect.innerHTML += `<option value="${l.toLowerCase()}">${l}</option>`;
      });
    }

    // Auto filter when inputs change
    ["filterBrand","filterLength","filterMinCost","filterMaxCost"].forEach(id => {
      document.addEventListener("input", e => { if (e.target.id === id) applyFilters(); });
      document.addEventListener("change", e => { if (e.target.id === id) applyFilters(); });
    });

    function applyFilters() {
      const brandSelect = document.getElementById("filterBrand");
      const selectedBrands = Array.from(brandSelect.selectedOptions).map(opt => opt.value);
      const length = document.getElementById("filterLength").value;
      const minCost = parseFloat(document.getElementById("filterMinCost").value) || 0;
      const maxCost = parseFloat(document.getElementById("filterMaxCost").value) || Infinity;
      renderFilteredPianos(selectedBrands, length, minCost, maxCost);
    }

    function resetFilters() {
      document.getElementById("filterBrand").selectedIndex = -1;
      document.getElementById("filterLength").value = "";
      document.getElementById("filterMinCost").value = "";
      document.getElementById("filterMaxCost").value = "";
      renderFilteredPianos([], "", 0, Infinity);
    }

    function renderFilteredPianos(selectedBrands, length, minCost, maxCost) {
      document.getElementById("active-list").innerHTML = "";
      document.getElementById("sold-list").innerHTML = "";

      let matchCount = 0;
      const applied = [];

      if (selectedBrands.length > 0) {
        applied.push("Brand: " + selectedBrands.map(b => b.charAt(0).toUpperCase() + b.slice(1)).join(", "));
      }
      if (length) {
        applied.push("Length: " + length);
      }
      if (minCost > 0 || maxCost < Infinity) {
        applied.push("Cost: " + (minCost > 0 ? `$${minCost}` : "Any") + " ‚Äì " + (maxCost < Infinity ? `$${maxCost}` : "Any"));
      }

      allPianos.forEach(doc => {
        const data = doc.data();
        const matchesBrand = selectedBrands.length === 0 || selectedBrands.includes(data.brand?.toLowerCase());
        const matchesLength = !length || data.length?.toLowerCase() === length;
        const matchesCost = (!data.cost || (data.cost >= minCost && data.cost <= maxCost));

        if (matchesBrand && matchesLength && matchesCost) {
          if (data.status === "active") {
            matchCount++;
            renderPiano(doc, "active-list");
          }
          if (data.status === "sold") {
            matchCount++;
            renderPiano(doc, "sold-list");
          }
        }
      });

      const summary = applied.length > 0
        ? `Filtering by ‚Üí ${applied.join(" | ")}   (${matchCount} match${matchCount !== 1 ? "es" : ""})`
        : `Showing all pianos (${matchCount} total)`;

      document.getElementById("filterSummary").innerText = summary;
    }

    function renderPiano(doc, containerId) {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "piano-card";
      div.innerHTML = `
        <strong>${data.brand || "Unknown"} ${data.model || ""}</strong><br>
        Length: ${data.length || "N/A"}<br>
        Cost: ${data.cost ? "$" + data.cost : "N/A"}<br>
        Year: ${data.year || "N/A"}
      `;
      document.getElementById(containerId).appendChild(div);
    }

    // Firestore listener
    db.collection("pianos").orderBy("createdAt","desc").onSnapshot(snapshot => {
      allPianos = snapshot.docs;
      populateDropdowns();
      resetFilters();
    });
  </script>

</body>
</html>
