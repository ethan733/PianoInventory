const deliveredListEl=document.getElementById("delivered-list");

function render(){
  activeListEl.innerHTML="";
  soldListEl.innerHTML="";
  deliveredListEl.innerHTML="";
  archiveListEl.innerHTML="";

  activeListEl.classList.toggle("hidden",currentTab!=="active");
  soldListEl.classList.toggle("hidden",currentTab!=="sold");
  deliveredListEl.classList.toggle("hidden",currentTab!=="delivered");
  archiveListEl.classList.toggle("hidden",currentTab!=="archive");
  soldSummaryEl.classList.toggle("hidden",currentTab!=="sold");

  // ... existing filtering/sorting

  for(const d of filtered){
    const c=document.createElement("div");
    c.className="card";

    let extra="";
    if(d.status==="delivered" && d.deliveredAt?.toDate){
      extra=`<div><strong>Delivered on:</strong> ${d.deliveredAt.toDate().toLocaleDateString()}</div>
             ${d.deliveryDate?`<div><strong>Planned Date:</strong> ${d.deliveryDate}</div>`:""}
             ${d.deliveryNotes?`<div><strong>Notes:</strong> ${d.deliveryNotes}</div>`:""}`;
    }

    // ...existing sold/archive details

    c.innerHTML=`
      ${d.photoURL?`<div><img src="${d.photoURL}" alt="photo" style="width:100%; max-height:180px; object-fit:cover; border-radius:6px; margin-bottom:8px; cursor:pointer;" onclick="openPreview('${d.photoURL}')"></div>`:""}
      <h3>${(d.brand||"")+(d.model?" "+d.model:"")}</h3>
      <div class="meta">Status: ${d.status}${d.year?" • Year "+d.year:""}${d.color?" • "+d.color:""}${d.location?" • "+d.location:""}</div>
      ${d.notes?`<div class="meta">${d.notes}</div>`:""}
      ${extra}
      <div class="actions">
        ${currentUser?`
          ${d.status!=="sold"?`<button class="blue" onclick="updateStatus('${d._id}','sold')">Sell</button>`:""}
          ${d.status!=="delivered"?`<button class="green" onclick="updateStatus('${d._id}','delivered')">Deliver</button>`:""}
          ${d.status!=="archive"?`<button class="gray" onclick="updateStatus('${d._id}','archive')">Archive</button>`:""}
          ${d.status!=="active"?`<button class="green" onclick="updateStatus('${d._id}','active')">Activate</button>`:""}
          <button class="orange" onclick='(function(){ window.__setEdit("${d._id}"); })()'>Edit</button>
          <button class="red" onclick="deletePiano('${d._id}')">Delete</button>`:""}
      </div>
    `;

    if(d.status==="active")activeListEl.appendChild(c);
    if(d.status==="sold")soldListEl.appendChild(c);
    if(d.status==="delivered")deliveredListEl.appendChild(c);
    if(d.status==="archive")archiveListEl.appendChild(c);
  }
}
