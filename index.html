<!DOCTYPE html>
<html>
<head>
  <title>Piano Inventory</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 0; }
    button { margin: 5px; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; }
    .add-btn { background: green; color: white; }
    .delete-btn { background: red; color: white; }
    .archive-btn { background: gray; color: white; }
    .sold-btn { background: blue; color: white; }
    .tab { display: inline-block; margin-right: 10px; padding: 8px; cursor: pointer; border: 1px solid #ccc; border-radius: 6px; }
    .tab.active { background: #007BFF; color: white; }
    .form-section { margin: 15px 0; padding: 10px; border: 1px solid #ddd; border-radius: 6px; display: none; }
    .piano-item { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>Piano Inventory</h2>

  <!-- Tabs -->
  <div>
    <span class="tab active" data-tab="active">Active</span>
    <span class="tab" data-tab="sold">Sold</span>
    <span class="tab" data-tab="archived">Archived</span>
    <span class="tab" id="toggleForm">âž• Add Piano</span>
  </div>

  <!-- Add Piano Form -->
  <div class="form-section" id="formSection">
    <h3>Add Piano</h3>
    <label>Brand: <input type="text" id="brand"></label><br>
    <label>Model: <input type="text" id="model"></label><br>
    <label>Model Year: <input type="text" id="modelYear"></label><br>
    <label>Serial: <input type="text" id="serial"></label><br>
    <label>Price: <input type="text" id="price"></label><br>
    <label>Color: <input type="text" id="color"></label><br>
    <label>Length: <input type="text" id="length"></label><br>
    <label>Location:
      <select id="location">
        <option value="Gallery">Gallery</option>
        <option value="Cartersville">Cartersville</option>
      </select>
    </label><br>
    <label>Player System: <input type="text" id="playerSystem"></label><br>
    <label>Detailed: <input type="checkbox" id="detailed"></label><br>
    <label>Notes: <textarea id="notes"></textarea></label><br>
    <button class="add-btn" id="addPiano">Add Piano</button>
  </div>

  <!-- Piano Lists -->
  <div id="active" class="tab-content"></div>
  <div id="sold" class="tab-content" style="display:none;"></div>
  <div id="archived" class="tab-content" style="display:none;"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // Your Firebase config here
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Tab handling
    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        if (tab.id === "toggleForm") {
          document.getElementById("formSection").style.display =
            document.getElementById("formSection").style.display === "none" ? "block" : "none";
          return;
        }
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        document.querySelectorAll(".tab-content").forEach(c => c.style.display = "none");
        document.getElementById(tab.dataset.tab).style.display = "block";
      });
    });

    // Add piano
    document.getElementById("addPiano").addEventListener("click", async () => {
      const piano = {
        brand: document.getElementById("brand").value,
        model: document.getElementById("model").value,
        modelYear: document.getElementById("modelYear").value,
        serial: document.getElementById("serial").value,
        price: document.getElementById("price").value,
        color: document.getElementById("color").value,
        length: document.getElementById("length").value,
        location: document.getElementById("location").value,
        playerSystem: document.getElementById("playerSystem").value,
        detailed: document.getElementById("detailed").checked,
        notes: document.getElementById("notes").value,
        status: "On Floor",
        archived: false,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      };
      await db.collection("pianos").add(piano);
      document.getElementById("formSection").style.display = "none";
    });

    // Render function
    function renderPiano(doc) {
      const piano = doc.data();
      const div = document.createElement("div");
      div.className = "piano-item";
      div.innerHTML = `
        <strong>${piano.brand || ""} ${piano.model || ""} (${piano.modelYear || ""})</strong><br>
        Serial: ${piano.serial || ""}<br>
        Price: $${piano.price || ""}<br>
        Color: ${piano.color || ""}<br>
        Length: ${piano.length || ""}<br>
        Location: ${piano.location || ""}<br>
        Player System: ${piano.playerSystem || ""}<br>
        Detailed: <input type="checkbox" class="detailed-checkbox" ${piano.detailed ? "checked" : ""}><br>
        Status:
        <select class="status-select">
          <option value="On Floor" ${piano.status === "On Floor" ? "selected" : ""}>On Floor</option>
          <option value="In Storage" ${piano.status === "In Storage" ? "selected" : ""}>In Storage</option>
          <option value="Potential Buyer" ${piano.status === "Potential Buyer" ? "selected" : ""}>Potential Buyer</option>
          <option value="Sold" ${piano.status === "Sold" ? "selected" : ""}>Sold</option>
        </select><br>
        Notes: ${piano.notes || ""}<br>
        <button class="delete-btn">Delete</button>
        <button class="archive-btn">Archive</button>
      `;

      // Status change
      div.querySelector(".status-select").addEventListener("change", e => {
        db.collection("pianos").doc(doc.id).update({ status: e.target.value });
      });

      // Detailed toggle
      div.querySelector(".detailed-checkbox").addEventListener("change", e => {
        db.collection("pianos").doc(doc.id).update({ detailed: e.target.checked });
      });

      // Delete
      div.querySelector(".delete-btn").addEventListener("click", () => {
        db.collection("pianos").doc(doc.id).delete();
      });

      // Archive
      div.querySelector(".archive-btn").addEventListener("click", () => {
        db.collection("pianos").doc(doc.id).update({ archived: true });
      });

      // Append to correct tab
      if (piano.archived) {
        document.getElementById("archived").appendChild(div);
      } else if (piano.status === "Sold") {
        document.getElementById("sold").appendChild(div);
      } else {
        document.getElementById("active").appendChild(div);
      }
    }

    // Live listener
    db.collection("pianos").orderBy("timestamp", "desc").onSnapshot(snapshot => {
      document.getElementById("active").innerHTML = "";
      document.getElementById("sold").innerHTML = "";
      document.getElementById("archived").innerHTML = "";
      snapshot.forEach(doc => renderPiano(doc));
    });
  </script>
</body>
</html>
