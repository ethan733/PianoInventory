<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Piano Inventory</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f5f5f5; }
    button { margin: 2px; padding: 5px 10px; }
    #sellForm { border: 1px solid #aaa; padding: 10px; margin-top: 10px; display: none; }
  </style>
</head>
<body>
  <h1>Piano Inventory</h1>
  <table id="inventoryTable">
    <thead>
      <tr><th>Model</th><th>Brand</th><th>Stock</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Sell Piano</h2>
  <div id="sellForm">
    <label>Sold For ($):</label><br>
    <input id="soldFor" type="number"><br>
    <label>Delivery Address:</label><br>
    <input id="deliveryAddress" type="text"><br>
    <label>Delivery Date:</label><br>
    <input id="deliveryDate" type="date"><br>
    <label>Number of Stairs:</label><br>
    <input id="stairs" type="number"><br><br>
    <button onclick="submitSale()">Confirm Sale</button>
    <button onclick="closeSellForm()">Cancel</button>
  </div>

  <h2>Archived Sales</h2>
  <ul id="salesList"></ul>

  <script>
    // Initial data
    let pianos = JSON.parse(localStorage.getItem("pianos")) || [
      { id: 1, model: "Model S", brand: "Steinway", stock: 3 },
      { id: 2, model: "C3", brand: "Yamaha", stock: 5 },
      { id: 3, model: "K-300", brand: "Kawai", stock: 2 }
    ];
    let sales = JSON.parse(localStorage.getItem("sales")) || [];
    let currentPianoId = null;

    function saveData() {
      localStorage.setItem("pianos", JSON.stringify(pianos));
      localStorage.setItem("sales", JSON.stringify(sales));
    }

    function renderInventory() {
      const tbody = document.querySelector("#inventoryTable tbody");
      tbody.innerHTML = "";
      pianos.forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.model}</td>
          <td>${p.brand}</td>
          <td>${p.stock}</td>
          <td>
            <button onclick="openSellForm(${p.id})" ${p.stock <= 0 ? "disabled" : ""}>Sell</button>
            <button onclick="editStock(${p.id})">Edit Stock</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderSales() {
      const ul = document.getElementById("salesList");
      ul.innerHTML = "";
      sales.forEach(s => {
        const li = document.createElement("li");
        li.textContent = `${s.brand} ${s.model} sold for $${s.soldFor} to ${s.deliveryAddress} on ${s.deliveryDate} (${s.stairs} stairs)`;
        ul.appendChild(li);
      });
    }

    function openSellForm(id) {
      currentPianoId = id;
      document.getElementById("sellForm").style.display = "block";
    }

    function closeSellForm() {
      document.getElementById("sellForm").style.display = "none";
      currentPianoId = null;
    }

    function submitSale() {
      const piano = pianos.find(p => p.id === currentPianoId);
      if (!piano || piano.stock <= 0) {
        alert("Piano not available");
        return;
      }
      const sale = {
        model: piano.model,
        brand: piano.brand,
        soldFor: document.getElementById("soldFor").value,
        deliveryAddress: document.getElementById("deliveryAddress").value,
        deliveryDate: document.getElementById("deliveryDate").value,
        stairs: document.getElementById("stairs").value
      };
      sales.push(sale);
      piano.stock -= 1;
      saveData();
      renderInventory();
      renderSales();
      closeSellForm();
    }

    function editStock(id) {
      const piano = pianos.find(p => p.id === id);
      const newStock = prompt("Enter new stock for " + piano.model, piano.stock);
      if (newStock !== null) {
        piano.stock = parseInt(newStock, 10) || piano.stock;
        saveData();
        renderInventory();
      }
    }

    renderInventory();
    renderSales();
  </script>
</body>
</html>
