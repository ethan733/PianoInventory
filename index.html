<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Piano Inventory</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    .tab { margin: 5px; padding: 10px; cursor: pointer; border: 1px solid #ccc; display: inline-block; }
    .active-tab { background: #007bff; color: white; }
    .piano-card { border: 1px solid #ccc; padding: 10px; margin: 5px; border-radius: 5px; }
    button { margin: 5px; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }
    .add-btn { background: green; color: white; }
    .delete-btn { background: red; color: white; }
    .sold-btn { background: blue; color: white; }
  </style>
</head>
<body>
  <h1>Piano Inventory</h1>

  <!-- Login Section -->
  <div id="loginDiv">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <button onclick="signup()">Sign Up</button>
  </div>

  <!-- Main App -->
  <div id="app" class="hidden">
    <button onclick="logout()">Logout</button>

    <!-- Tabs -->
    <div>
      <span class="tab active-tab" onclick="showTab('inventoryTab')">Active Inventory</span>
      <span class="tab" onclick="showTab('archiveTab')">Archive</span>
      <span class="tab" onclick="showTab('addTab')">Add Piano</span>
    </div>

    <!-- Inventory Tab -->
    <div id="inventoryTab" class="tab-content">
      <h2>Active Pianos</h2>
      <div id="inventoryList"></div>
    </div>

    <!-- Archive Tab -->
    <div id="archiveTab" class="tab-content hidden">
      <h2>Archived (Sold) Pianos</h2>
      <div id="archiveList"></div>
    </div>

    <!-- Add Piano Tab -->
    <div id="addTab" class="tab-content hidden">
      <h2>Add Piano</h2>
      <form id="pianoForm">
        <input type="text" id="brand" placeholder="Brand" required><br>
        <input type="text" id="model" placeholder="Model"><br>
        <input type="text" id="serial" placeholder="Serial"><br>
        <input type="number" id="modelYear" placeholder="Model Year"><br>
        <input type="number" id="length" placeholder="Length (in inches)"><br>
        <input type="text" id="color" placeholder="Color"><br>
        <select id="location">
          <option value="Gallery">Gallery</option>
          <option value="Cartersville">Cartersville</option>
        </select><br>
        <label>
          Player System: 
          <input type="checkbox" id="playerSystem">
        </label><br>
        <label>
          Detailed: 
          <input type="checkbox" id="detailed">
        </label><br>
        <textarea id="notes" placeholder="Notes"></textarea><br>
        <input type="number" id="price" placeholder="Price"><br>
        <button type="submit" class="add-btn">Add Piano</button>
      </form>
    </div>
  </div>

  <script>
    // Firebase Config (replace with your own)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Auth
    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password).catch(alert);
    }
    function signup() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password).catch(alert);
    }
    function logout() { auth.signOut(); }

    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById("loginDiv").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        loadInventory();
        loadArchive();
      } else {
        document.getElementById("loginDiv").classList.remove("hidden");
        document.getElementById("app").classList.add("hidden");
      }
    });

    // Tabs
    function showTab(tabId) {
      document.querySelectorAll(".tab-content").forEach(div => div.classList.add("hidden"));
      document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active-tab"));
      document.getElementById(tabId).classList.remove("hidden");
      document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add("active-tab");
    }

    // Add Piano
    document.getElementById("pianoForm").addEventListener("submit", e => {
      e.preventDefault();
      const piano = {
        brand: document.getElementById("brand").value,
        model: document.getElementById("model").value,
        serial: document.getElementById("serial").value,
        modelYear: document.getElementById("modelYear").value,
        length: document.getElementById("length").value,
        color: document.getElementById("color").value,
        location: document.getElementById("location").value,
        playerSystem: document.getElementById("playerSystem").checked,
        detailed: document.getElementById("detailed").checked,
        notes: document.getElementById("notes").value,
        price: document.getElementById("price").value,
        status: "Active",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      db.collection("pianos").add(piano).then(() => {
        document.getElementById("pianoForm").reset();
        showTab('inventoryTab');
      });
    });

    // Load Inventory
    function loadInventory() {
      db.collection("pianos").orderBy("createdAt", "desc").onSnapshot(snapshot => {
        const list = document.getElementById("inventoryList");
        list.innerHTML = "";
        snapshot.forEach(doc => {
          const piano = doc.data();
          const div = document.createElement("div");
          div.classList.add("piano-card");
          div.innerHTML = `
            <strong>${piano.brand || ""} ${piano.model || ""} (${piano.modelYear || ""})</strong><br>
            Serial: ${piano.serial || ""}<br>
            Price: $${piano.price || ""}<br>
            Location: ${piano.location || ""}<br>
            Status: ${piano.status}<br>
            Notes: ${piano.notes || ""}<br>
            <button class="sold-btn">Mark as Sold</button>
            <button class="delete-btn">Delete</button>
          `;
          // Mark as sold
          div.querySelector(".sold-btn").addEventListener("click", () => {
            if (confirm("Are you sure you want to mark this piano as Sold?")) {
              const updated = { ...piano, status: "Sold", soldAt: firebase.firestore.FieldValue.serverTimestamp() };
              db.collection("archive").add(updated).then(() => {
                db.collection("pianos").doc(doc.id).delete();
              });
            }
          });
          // Delete
          div.querySelector(".delete-btn").addEventListener("click", () => {
            if (confirm("Are you sure you want to delete this piano?")) {
              db.collection("pianos").doc(doc.id).delete();
            }
          });
          list.appendChild(div);
        });
      });
    }

    // Load Archive
    function loadArchive() {
      db.collection("archive").orderBy("soldAt", "desc").onSnapshot(snapshot => {
        const list = document.getElementById("archiveList");
        list.innerHTML = "";
        snapshot.forEach(doc => {
          const piano = doc.data();
          const div = document.createElement("div");
          div.classList.add("piano-card");
          div.innerHTML = `
            <strong>${piano.brand || ""} ${piano.model || ""} (${piano.modelYear || ""})</strong><br>
            Serial: ${piano.serial || ""}<br>
            Price: $${piano.price || ""}<br>
            Location: ${piano.location || ""}<br>
            Status: ${piano.status}<br>
            Notes: ${piano.notes || ""}<br>
            <button class="delete-btn">Delete</button>
          `;
          // Delete from archive
          div.querySelector(".delete-btn").addEventListener("click", () => {
            if (confirm("Are you sure you want to delete this archived piano?")) {
              db.collection("archive").doc(doc.id).delete();
            }
          });
          list.appendChild(div);
        });
      });
    }
  </script>
</body>
</html>
